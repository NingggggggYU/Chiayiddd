<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" sizes="16x16"  href="./caldbs.ico">
    <link rel="shortcut icon" sizes="16x16"  href="./caldbs.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="./appleicon.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中華航空系統登入驗證 / China Airlines System Login Verification</title>
    <style>
        .version-text {
            position: absolute;
            top: 10px; /* Adjust to position the text at the desired location */
            right: 10px; /* Adjust to position the text at the desired location */
            font-size: 12px;
            color: #808080;
            font-weight: bold;
	    z-index:1000;
        }

        /* Add CSS for IP address display */
        #ip-container {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: #808080;
            font-weight: bold;
	    z-index:1000;
        }

	.password-toggle {
 	    position: absolute;
	    right: 10px;
 	    top: 50%;
	    transform: translateY(-50%);
	    background: none;
	    border: none;
	    cursor: pointer;
 	    padding: 5px;
	}

	.password-toggle img {
 	   width:  24px;
  	   height: 24px;
	   vertical-align: middle;
}
    </style>
    <script type="text/javascript">
        var warningString = "";
        document.cookie = 'acceptsCookies=yes';
        if(document.cookie == ''){
          document.write(warningString);
        }
        else{
          document.cookie = 'acceptsCookies=yes; expires=Fri, 13-Apr-1970 00:00:00 GMT';
          // Uncomment the following line for JavaScript redirection
          // document.cookie = 'ISAMOriginalURL=' + encodeURIComponent(window.location) + "; Path=/;";
		  if(window.location.pathname != "https://iam.china-airlines.com/mga/sps/auth/pkmlogin.form"){
            document.cookie = 'ISAMOriginalURL=' + encodeURIComponent(window.location) + "; Path=/;";
          }
        }
     </script>
     <noscript>
        <div id="browser-notice" class="bg-warning text-center">
        <b>警告：</b> 若要保留您的登入階段作業，請確定<br/>
           您的瀏覽器已配置為接受 Cookie。
        </div>
     </noscript>
	
</head>
<body>
    <div id="main">
      <div class="version-text">Version : 24.25</div>
      <form class="login-container" method="POST" action="https://hdqweb02.china-airlines.com/webjc/brief/dbsLogin.action">
        <!-- main-header Start-->
        <div id="main-header">
          <div>
            <img src="chinaairlinesicon.png" alt="China Airlines Logo">
          </div>
          <h1 id="page-title">中華航空系統登入驗證</h1>
          <p id="page-title-en">China Airlines System Login Verification</p>
          <div class="intro">
          </div>
        </div>
        <!-- main-header End-->

        <!-- login-inputs Start-->
        <div id="main-content" class="login-inputs">

          <div class="a-form-control">
            <label class="form-label" for="username">使用者名稱 / Your ID</label>
            <input class="input-field " placeholder="" id="uname" type="text" name="uname">
          </div>
          <div class="a-form-control" style="position: relative; display:inline-block; width:100%">
            <label class="form-label" for="password">密碼 / Password</label>
            <input class="input-field " placeholder="" id="pass" type="password" name="pass" autocomplete="off">
	    <button type="button" id="toggle-password" class="password-toggle">
		    <img src="eye-icon.svg" alt="Show/Hide Password" id="password-icon">
	    </button>
          </div>

          <input type="hidden" name="login-form-type" value="pwd">
          <input type="hidden" name="token" value="Unknown">

          <!-- error-box Start-->
          <div class="error-box" id="error-box">
            <img style="float:left" src="error.png">
            <div id="errId"></div>
          </div>
          <!-- error-box End-->


          <p class="a-form-control-exe">
            <input id="btn-submitButton" class="btn btn-primary" type="submit" value="登入 / Login">
          </p>

          <div class="sub-links">
            <p class="text-center">
              <a href="https://hdqweb02.china-airlines.com/webjc/brief/choose.action">簽派簡報系統 Dispatch Briefing System</a>
            </p>
          </div>
		<!-- IP Address Container -->
    	<div id="ip-container">
        <span id="ip-address">Loading IP address...</span>
    	</div>

        </div>
        <!-- login-inputs End-->

      </form>
      </div>

    <script>
        const correctPassword = "CALDBS";
        let attemptCount = 0; // Counter for failed attempts
        const maxAttempts = 1; // Maximum allowed attempts

        function checkCredentials() {
            const password = prompt('Login WEB');
            if (password === null) {
                // If user cancels the prompt
                attemptCount++;
                if (attemptCount >= maxAttempts) {
                    window.location.href = 'https://iam.china-airlines.com/mga/sps/auth'; // Redirect to CI iam
                } else {
                    checkCredentials(); // Re-prompt for password
                }
            } else if (password && password.toUpperCase() === correctPassword.toUpperCase()) {
                document.getElementById('content').style.display = 'block';
            } else {
                attemptCount++;
                if (attemptCount >= maxAttempts) {
                    window.location.href = 'https://iam.china-airlines.com/mga/sps/auth'; // Redirect to CI iam
                } else {
                    checkCredentials(); // Re-prompt for password
                }
            }
        }

        window.onload = checkCredentials;

        fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
            document.getElementById('ip-address').textContent = data.ip;
        })
        .catch(error => {
            document.getElementById('ip-address').textContent = 'Unable to retrieve IP address';
        });

	const passwordField = document.getElementById('pass');
	const togglePasswordButton = document.getElementById('toggle-password');
	const passwordIcon = document.getElementById('password-icon');

	togglePasswordButton.addEventListener('mousedown', function() {
 	   passwordField.type = 'text';
	});

	togglePasswordButton.addEventListener('mouseup', function() {
	    passwordField.type = 'password';
	});

	togglePasswordButton.addEventListener('mouseleave', function() {
  	  passwordField.type = 'password';
	});
    </script>
</body>
</html>
